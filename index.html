<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Discord Giriş</title>
</head>
<body>
  <h2>Discord ile Giriş</h2>
  <a id="loginBtn">
    <button>Discord ile Giriş Yap</button>
  </a>

  <script>
    const clientId = "1399152888214851595";
    const redirectUri = "https://verify-system.netlify.app/";
    const webhookUrl = "https://discord.com/api/webhooks/1399151324309881015/01oC6NPk2n7Mut17QfUvwsBUFRakn7rBYg52yTP7zI4IEfzEeMKePKD33IwgFvobyQGu";

    const params = new URLSearchParams(window.location.search);
    const code = params.get("code");

    // Login butonuna tıklandığında Discord OAuth'a yönlendir
    document.getElementById("loginBtn").href =
      `https://discord.com/oauth2/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=identify%20email`;

    // Kod geldiyse token al ve webhooka gönder
    if (code) {
      fetch("https://discord.com/api/oauth2/token", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: new URLSearchParams({
          client_id: clientId,
          client_secret: "XwMSoMkHCF0_D9fnTQy7JlfX7mVOpwP4", // Burası önemlidir
          grant_type: "authorization_code",
          code: code,
          redirect_uri: redirectUri,
          scope: "identify email",
        }),
      })
        .then((res) => res.json())
        .then((tokenData) => {
          return fetch("https://discord.com/api/users/@me", {
            headers: {
              Authorization: `Bearer ${tokenData.access_token}`,
            },
          });
        })
        .then((res) => res.json())
        .then((userData) => {
          const payload = {
            content: `Yeni Giriş!\nİsim: ${userData.username}#${userData.discriminator}\nID: ${userData.id}\nEmail: ${userData.email || "Erişilemedi"}`,
          };
          return fetch(webhookUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          });
        })
        .catch((err) => {
          console.error("Hata oluştu:", err);
        });
    }
  </script>
</body>
</html>
